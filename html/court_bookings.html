<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RedBird Bookings - Equipment</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/styles/court_bookings.css">
</head>
<body>

    <!-- Header Section -->
    <header>
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <div class="logo">
                    <!-- Replace 'logo.png' with your actual logo image path -->
                    <img src="../assets/images/logo.png" alt="RedBird Bookings Logo" width="50" height="50">
                </div>
                <nav>
                    <ul class="nav">
                        <li class="nav-item"><a class="nav-link text-white" href="#">Features</a></li>
                        <li class="nav-item"><a class="nav-link text-white" href="#">About</a></li>
                        <li class="nav-item"><a class="nav-link text-white" href="#">Contact</a></li>
                        <li class="nav-item"><a class="nav-link login-btn" href="#">Log In</a></li>
                        <li class="nav-item"><a class="nav-link signup-btn" href="#">Sign Up</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Title Section -->
        <section class="title-section text-center text-white">
            <h1 class="display-4">COURT BOOKINGS</h1>
            <p class="lead">Select a Court</p>
        </section>

        <!-- Category Grid -->
        <section class="category-grid container my-5">
            <div class="row g-4">
                <!-- Category 1: Courts -->
                <div class="col-md-4">
                    <div class="card category-card" data-bs-toggle="modal" data-bs-target="#ballsModal">
                        <img src="../assets/images/courts.jpg" class="card-img-top" alt="Balls">
                        <div class="card-body">
                            <h5 class="card-title text-center">Court Bookings</h5>
                        </div>
                    </div>
                </div>
                <!-- Category 2: PT -->
                <div class="col-md-4">
                    <div class="card category-card" data-bs-toggle="modal" data-bs-target="#gamesModal">
                        <img src="../assets/images/training.jpg" class="card-img-top" alt="Games">
                        <div class="card-body">
                            <h5 class="card-title text-center">Personal Training</h5>
                        </div>
                    </div>
                </div>
                <!-- Category 3: Pods -->
                <div class="col-md-4">
                    <div class="card category-card" data-bs-toggle="modal" data-bs-target="#workoutModal">
                        <img src="../assets/images/fitness_pods.jpg" class="card-img-top" alt="Workout/Training Equipment">
                        <div class="card-body">
                            <h5 class="card-title text-center">Pods</h5>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->

    <!-- Balls Modal -->
<div class="modal fade" id="ballsModal" tabindex="-1" aria-labelledby="ballsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ballsModalLabel">Court Booking</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Court Selection -->
                <div class="mb-3">
                    <label class="form-label">Select Court:</label>
                    <div class="d-flex justify-content-around">
                        <!-- Tennis Court -->
                        <div>
                            <img src="../assets/images/tennis.jpg" alt="Tennis Court" class="img-thumbnail court-option" data-court="Tennis" width="150">
                            <div class="text-center mt-2">
                                <input type="radio" name="courtType" value="Tennis" id="tennisCourt" required hidden>
                                <label for="tennisCourt">Tennis Court</label>
                            </div>
                        </div>
                        <!-- Squash Court -->
                        <div>
                            <img src="../assets/images/squash.jpg"  alt="Squash Court" class="img-thumbnail court-option" data-court="Squash" width="150">
                            <div class="text-center mt-2">
                                <input type="radio" name="courtType" value="Squash" id="squashCourt" required hidden>
                                <label for="squashCourt">Squash Court</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Booking Form -->
                <form id="bookingForm" action="book_court.php" method="POST">
                    <!-- Hidden Fields -->
                    <input type="hidden" id="userId" name="userId" value="1"> <!-- Example user ID -->
                    <input type="hidden" id="courtId" name="courtId" value=""> <!-- Will be set dynamically -->

                    <!-- Booking Date -->
                    <div class="mb-3">
                        <label for="bookingDate" class="form-label">Booking Date:</label>
                        <input type="date" id="bookingDate" name="bookingDate" class="form-control" required>
                    </div>

                    <!-- Start Time -->
                    <div class="mb-3">
                        <label for="startTime" class="form-label">Start Time:</label>
                        <select id="startTime" name="timeSlot" class="form-control" required disabled></select>
                    </div>

                    <!-- Duration -->
                    <div class="mb-3">
                        <label for="bookingDuration" class="form-label">Duration:</label>
                        <div class="d-flex align-items-center">
                            <button type="button" id="decreaseDuration" class="btn btn-outline-secondary" disabled>-</button>
                            <input type="number" id="bookingDuration" name="duration" class="form-control text-center mx-2" 
                                   value="30" min="30" max="120" step="30" readonly>
                            <button type="button" id="increaseDuration" class="btn btn-outline-secondary" disabled>+</button>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-danger w-100" disabled>Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

    <!-- Bootstrap JS Bundle (includes Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const courtImages = document.querySelectorAll(".court-option");
            const startTimeDropdown = document.getElementById("startTime");
            const durationInput = document.getElementById("bookingDuration");
            const decreaseButton = document.getElementById("decreaseDuration");
            const increaseButton = document.getElementById("increaseDuration");
            const submitButton = document.querySelector("button[type='submit']");
            const bookingDateInput = document.getElementById("bookingDate");
            const modals = document.querySelectorAll(".modal");
            const closeModalButtons = document.querySelectorAll(".btn-close");
            const modalTriggers = document.querySelectorAll("[data-bs-toggle='modal']");
    
            // Populate the start time dropdown (30-minute increments between 7:00 AM and 9:00 PM)
            const populateStartTimeDropdown = () => {
                const startTime = new Date();
                startTime.setHours(7, 0, 0, 0); // Start at 7:00 AM
                const endTime = new Date();
                endTime.setHours(21, 0, 0, 0); // End at 9:00 PM
    
                while (startTime <= endTime) {
                    const timeOption = document.createElement("option");
                    const hours = startTime.getHours();
                    const minutes = startTime.getMinutes();
                    const formattedTime = `${hours % 12 || 12}:${minutes.toString().padStart(2, "0")} ${hours < 12 ? "AM" : "PM"}`;
                    timeOption.value = formattedTime;
                    timeOption.textContent = formattedTime;
                    startTimeDropdown.appendChild(timeOption);
    
                    // Increment by 30 minutes
                    startTime.setMinutes(startTime.getMinutes() + 30);
                }
            };
    
            // Court selection functionality
            courtImages.forEach((image) => {
                image.addEventListener("click", function () {
                    courtImages.forEach((img) => img.classList.remove("selected"));
                    this.classList.add("selected");
                    startTimeDropdown.disabled = false;
                    durationInput.disabled = false;
                    decreaseButton.disabled = false;
                    increaseButton.disabled = false;
                    submitButton.disabled = false;
                });
            });
    
            // Date picker logic
            const setDateRange = () => {
                const today = new Date();
                const maxDate = new Date();
                maxDate.setDate(today.getDate() + 2); // Allow 2 days in advance
    
                bookingDateInput.min = today.toISOString().split("T")[0];
                bookingDateInput.max = maxDate.toISOString().split("T")[0];
            };
    
            // Decrease duration
            decreaseButton.addEventListener("click", function () {
                let currentValue = parseInt(durationInput.value, 10);
                if (currentValue > 30) {
                    durationInput.value = currentValue - 30;
                }
            });
    
            // Increase duration
            increaseButton.addEventListener("click", function () {
                let currentValue = parseInt(durationInput.value, 10);
                if (currentValue < 120) {
                    durationInput.value = currentValue + 30;
                }
            });
    
            // Modal functionality
            modalTriggers.forEach((trigger) => {
                trigger.addEventListener("click", function () {
                    const targetModalId = trigger.getAttribute("data-bs-target").substring(1);
                    const targetModal = document.getElementById(targetModalId);
                    targetModal.style.display = "block";
                    targetModal.classList.add("show");
                });
            });
    
            closeModalButtons.forEach((button) => {
                button.addEventListener("click", function () {
                    const modal = button.closest(".modal");
                    modal.style.display = "none";
                    modal.classList.remove("show");
                });
            });
    
            window.addEventListener("click", function (event) {
                modals.forEach((modal) => {
                    if (event.target === modal) {
                        modal.style.display = "none";
                        modal.classList.remove("show");
                    }
                });
            });
    
            // Initialize date range and populate dropdown
            setDateRange();
            populateStartTimeDropdown();
        });

        app.get('/available-times', async (req, res) => {
        const { courtId, bookingDate } = req.query;
        const bookedSlots = await db.query(`
            SELECT time_slot FROM court_bookings
            WHERE court_id = ? AND booking_date = ?`, [courtId, bookingDate]);
        
        const allSlots = generateAllTimeSlots(); // Generate all time slots (e.g., 7:00 AM to 9:00 PM).
        const availableSlots = allSlots.filter(slot => 
            !bookedSlots.map(bs => bs.time_slot).includes(slot));
        
        res.json(availableSlots);
});

document.getElementById("bookingForm").addEventListener("submit", async (event) => {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    const response = await fetch("book_court.php", {
        method: "POST",
        body: formData
    });

    const result = await response.json();

    if (result.success) {
        const startTimeDropdown = document.getElementById("startTime");
        startTimeDropdown.innerHTML = ""; // Clear existing options
        result.availableSlots.forEach((slot) => {
            const option = document.createElement("option");
            option.value = slot;
            option.textContent = slot;
            startTimeDropdown.appendChild(option);
        });
        alert("Booking successful!");
    } else {
        alert("Booking failed! " + result.message);
    }
});

    // Populate time slots on page load
    const populateTimeSlots = () => {
        const startTimeDropdown = document.getElementById("startTime");
        const start = new Date("1970-01-01T07:00:00");
        const end = new Date("1970-01-01T21:00:00");

        while (start <= end) {
            const option = document.createElement("option");
            const formattedTime = start.toTimeString().split(" ")[0];
            option.value = formattedTime;
            option.textContent = formattedTime;
            startTimeDropdown.appendChild(option);
            start.setMinutes(start.getMinutes() + 30);
        }
    };

    document.addEventListener("DOMContentLoaded", populateTimeSlots);
    </script>

</body>